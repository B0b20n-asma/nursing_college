
{% extends 'college_db/base.html' %}
{% block title %}Student Details{% endblock %}

{% block content %}
<div class="page-header">
  <h3>{{ student.first_name }} {{ student.last_name }}</h3>
  <small>Admission: {{ student.admission_number }}</small>
</div>

<div class="row">
  <div class="col-md-4">
  <div class="card p-3">
    <p><strong>Phone:</strong> {{ student.phone }}</p>
    <p><strong>Email:</strong> {{ student.email }}</p>
    <p><strong>Address:</strong> {{ student.address }}</p>
    <p><strong>Status:</strong> {{ student.status }}</p>
    <a class="btn btn-primary" href="{% url 'edit_student' student.id %}">Edit</a>
    <a class="btn btn-danger" href="{% url 'delete_student' student.id %}">Delete</a>
    <a class="btn btn-outline-secondary mt-2" href="{% url 'student_pdf' student.id %}"><i class="fas fa-file-pdf"></i> Download PDF</a>
  </div>
</div>

  <div class="col-md-8">
    <div class="card p-3">

      {# --- Enrollments --- #}
      <h5>Enrollments ({{ enrollments|length }})</h5>

      {% if enrollments %}
        <ul class="list-unstyled">
          {% for e in enrollments %}
            <li>
              <strong>Course:</strong>
              {% if e.course %}{{ e.course.name }}{% else %}<em class="text-muted">No course set</em>{% endif %}
              —
              <strong>Year:</strong>
              {% if e.academic_year %}{{ e.academic_year }}{% else %}<em class="text-muted">No year</em>{% endif %}
              {% if e.grade %} — <strong>Grade:</strong> {{ e.grade }}{% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">
          No enrollments for this student. 
          Use <a href="{% url 'add_enrollment' student.id %}">Add Enrollment</a>
        </p>
      {% endif %}

      {# --- Fees --- #}
      <h5>Fees</h5>
      <ul>
        {% for f in fees %}
          <li>{{ f.amount }} - Due: {{ f.due_date }} - {{ f.paid|yesno:"Paid,Unpaid" }}</li>
        {% empty %}
          <li>No fee records</li>
        {% endfor %}
      </ul>

      {# --- Recent Attendance --- #}
      <h5>Recent Attendance</h5>
      <ul>
        {% for a in attendance %}
          <li>{{ a.date }} - {{ a.course }} - {{ a.present|yesno:"Present,Absent" }}</li>
        {% empty %}
          <li>No attendance records</li>
        {% endfor %}
      </ul>

      {# --- Grades Section --- #}
      <h5>Grades</h5>
      <a class="btn btn-sm btn-primary mb-2" href="{% url 'student_grades' student.id %}">View All Grades</a>
      {% with grades=student.grades.all|slice:":5" %}
        <table class="table">
          <thead><tr><th>Course</th><th>Score</th><th>Grade</th></tr></thead>
          <tbody>
            {% for g in grades %}
              <tr>
                <td>{% if g.course %}{{ g.course.name }}{% else %}-{% endif %}</td>
                <td>{{ g.score }}</td>
                <td>{{ g.grade_label }}</td>
              </tr>
            {% empty %}
              <tr><td colspan="3">No grades yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
        {% if student.grades.count > 5 %}
          <a href="{% url 'student_grades' student.id %}">See all</a>
        {% endif %}
      {% endwith %}
    </div>
  </div>
</div>
{% endblock %}